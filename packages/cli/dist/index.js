import { createRequire } from 'module';
import Pe from 'enquirer';
import { parseLiveUrl, initWsConnect, incoming } from '@liou666/live-parser-core';

const require = createRequire(import.meta.url);
var pe=Object.create;var x=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var me=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var O=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,n)=>(typeof require<"u"?require:r)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var d=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),ye=(e,r)=>{for(var n in r)x(e,n,{get:r[n],enumerable:!0});},we=(e,r,n,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of me(r))!ve.call(e,i)&&i!==n&&x(e,i,{get:()=>r[i],enumerable:!(t=he(r,i))||t.enumerable});return e};var Me=(e,r,n)=>(n=e!=null?pe(be(e)):{},we(r||!e||!e.__esModule?x(n,"default",{value:e,enumerable:!0}):n,e));var I=d((Ve,E)=>{var k={};E.exports=k;var S={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(S).forEach(function(e){var r=S[e],n=k[e]=[];n.open="\x1B["+r[0]+"m",n.close="\x1B["+r[1]+"m";});});var q=d((He,G)=>{G.exports=function(e,r){r=r||process.argv;var n=r.indexOf("--"),t=/^-{1,2}/.test(e)?"":"--",i=r.indexOf(t+e);return i!==-1&&(n===-1?!0:i<n)};});var L=d((Je,B)=>{var xe=O("os"),h=q(),l=process.env,y=void 0;h("no-color")||h("no-colors")||h("color=false")?y=!1:(h("color")||h("colors")||h("color=true")||h("color=always"))&&(y=!0);"FORCE_COLOR"in l&&(y=l.FORCE_COLOR.length===0||parseInt(l.FORCE_COLOR,10)!==0);function _e(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function Ce(e){if(y===!1)return 0;if(h("color=16m")||h("color=full")||h("color=truecolor"))return 3;if(h("color=256"))return 2;if(e&&!e.isTTY&&y!==!0)return 0;var r=y?1:0;if(process.platform==="win32"){var n=xe.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in l)return ["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(function(i){return i in l})||l.CI_NAME==="codeship"?1:r;if("TEAMCITY_VERSION"in l)return /^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(l.TEAMCITY_VERSION)?1:0;if("TERM_PROGRAM"in l){var t=parseInt((l.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(l.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Hyper":return 3;case"Apple_Terminal":return 2}}return /-256(color)?$/i.test(l.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(l.TERM)||"COLORTERM"in l?1:(l.TERM==="dumb",r)}function _(e){var r=Ce(e);return _e(r)}B.exports={supportsColor:_,stdout:_(process.stdout),stderr:_(process.stderr)};});var j=d((Ke,$)=>{$.exports=function(r,n){var t="";r=r||"Run the trap, drop the bass",r=r.split("");var i={a:["@","\u0104","\u023A","\u0245","\u0394","\u039B","\u0414"],b:["\xDF","\u0181","\u0243","\u026E","\u03B2","\u0E3F"],c:["\xA9","\u023B","\u03FE"],d:["\xD0","\u018A","\u0500","\u0501","\u0502","\u0503"],e:["\xCB","\u0115","\u018E","\u0258","\u03A3","\u03BE","\u04BC","\u0A6C"],f:["\u04FA"],g:["\u0262"],h:["\u0126","\u0195","\u04A2","\u04BA","\u04C7","\u050A"],i:["\u0F0F"],j:["\u0134"],k:["\u0138","\u04A0","\u04C3","\u051E"],l:["\u0139"],m:["\u028D","\u04CD","\u04CE","\u0520","\u0521","\u0D69"],n:["\xD1","\u014B","\u019D","\u0376","\u03A0","\u048A"],o:["\xD8","\xF5","\xF8","\u01FE","\u0298","\u047A","\u05DD","\u06DD","\u0E4F"],p:["\u01F7","\u048E"],q:["\u09CD"],r:["\xAE","\u01A6","\u0210","\u024C","\u0280","\u042F"],s:["\xA7","\u03DE","\u03DF","\u03E8"],t:["\u0141","\u0166","\u0373"],u:["\u01B1","\u054D"],v:["\u05D8"],w:["\u0428","\u0460","\u047C","\u0D70"],x:["\u04B2","\u04FE","\u04FC","\u04FD"],y:["\xA5","\u04B0","\u04CB"],z:["\u01B5","\u0240"]};return r.forEach(function(o){o=o.toLowerCase();var f=i[o]||[" "],m=Math.floor(Math.random()*f.length);typeof i[o]<"u"?t+=i[o][m]:t+=o;}),t};});var z=d((Qe,Y)=>{Y.exports=function(r,n){r=r||"   he is here   ";var t={up:["\u030D","\u030E","\u0304","\u0305","\u033F","\u0311","\u0306","\u0310","\u0352","\u0357","\u0351","\u0307","\u0308","\u030A","\u0342","\u0313","\u0308","\u034A","\u034B","\u034C","\u0303","\u0302","\u030C","\u0350","\u0300","\u0301","\u030B","\u030F","\u0312","\u0313","\u0314","\u033D","\u0309","\u0363","\u0364","\u0365","\u0366","\u0367","\u0368","\u0369","\u036A","\u036B","\u036C","\u036D","\u036E","\u036F","\u033E","\u035B","\u0346","\u031A"],down:["\u0316","\u0317","\u0318","\u0319","\u031C","\u031D","\u031E","\u031F","\u0320","\u0324","\u0325","\u0326","\u0329","\u032A","\u032B","\u032C","\u032D","\u032E","\u032F","\u0330","\u0331","\u0332","\u0333","\u0339","\u033A","\u033B","\u033C","\u0345","\u0347","\u0348","\u0349","\u034D","\u034E","\u0353","\u0354","\u0355","\u0356","\u0359","\u035A","\u0323"],mid:["\u0315","\u031B","\u0300","\u0301","\u0358","\u0321","\u0322","\u0327","\u0328","\u0334","\u0335","\u0336","\u035C","\u035D","\u035E","\u035F","\u0360","\u0362","\u0338","\u0337","\u0361"," \u0489"]},i=[].concat(t.up,t.down,t.mid);function o(g){var a=Math.floor(Math.random()*g);return a}function f(g){var a=!1;return i.filter(function(b){a=b===g;}),a}function m(g,a){var b="",p,M;a=a||{},a.up=typeof a.up<"u"?a.up:!0,a.mid=typeof a.mid<"u"?a.mid:!0,a.down=typeof a.down<"u"?a.down:!0,a.size=typeof a.size<"u"?a.size:"maxi",g=g.split("");for(M in g)if(!f(M)){switch(b=b+g[M],p={up:0,down:0,mid:0},a.size){case"mini":p.up=o(8),p.mid=o(2),p.down=o(8);break;case"maxi":p.up=o(16)+3,p.mid=o(4)+1,p.down=o(64)+3;break;default:p.up=o(8)+1,p.mid=o(6)/2,p.down=o(8)+1;break}var R=["up","mid","down"];for(var de in R)for(var w=R[de],T=0;T<=p[w];T++)a[w]&&(b=b+t[w][o(t[w].length)]);}return b}return m(r,n)};});var A=d((Xe,N)=>{N.exports=function(e){return function(r,n,t){if(r===" ")return r;switch(n%3){case 0:return e.red(r);case 1:return e.white(r);case 2:return e.blue(r)}}};});var P=d((Ze,D)=>{D.exports=function(e){return function(r,n,t){return n%2===0?r:e.inverse(r)}};});var F=d((er,U)=>{U.exports=function(e){var r=["red","yellow","green","blue","magenta"];return function(n,t,i){return n===" "?n:e[r[t++%r.length]](n)}};});var V=d((rr,W)=>{W.exports=function(e){var r=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta","brightYellow","brightRed","brightGreen","brightBlue","brightWhite","brightCyan","brightMagenta"];return function(n,t,i){return n===" "?n:e[r[Math.round(Math.random()*(r.length-2))]](n)}};});var C=d((tr,X)=>{var s={};X.exports=s;s.themes={};var Re=O("util"),v=s.styles=I(),J=Object.defineProperties,Te=new RegExp(/[\r\n]+/g);s.supportsColor=L().supportsColor;typeof s.enabled>"u"&&(s.enabled=s.supportsColor()!==!1);s.enable=function(){s.enabled=!0;};s.disable=function(){s.enabled=!1;};s.stripColors=s.strip=function(e){return (""+e).replace(/\x1B\[\d+m/g,"")};s.stylize=function(r,n){if(!s.enabled)return r+"";var t=v[n];return !t&&n in s?s[n](r):t.open+r+t.close};var Oe=/[|\\{}()[\]^$+*?.]/g,Se=function(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(Oe,"\\$&")};function K(e){var r=function n(){return Ee.apply(n,arguments)};return r._styles=e,r.__proto__=ke,r}var Q=function(){var e={};return v.grey=v.gray,Object.keys(v).forEach(function(r){v[r].closeRe=new RegExp(Se(v[r].close),"g"),e[r]={get:function(){return K(this._styles.concat(r))}};}),e}(),ke=J(function(){},Q);function Ee(){var e=Array.prototype.slice.call(arguments),r=e.map(function(f){return f!=null&&f.constructor===String?f:Re.inspect(f)}).join(" ");if(!s.enabled||!r)return r;for(var n=r.indexOf(`
`)!=-1,t=this._styles,i=t.length;i--;){var o=v[t[i]];r=o.open+r.replace(o.closeRe,o.open)+o.close,n&&(r=r.replace(Te,function(f){return o.close+f+o.open}));}return r}s.setTheme=function(e){if(typeof e=="string"){console.log("colors.setTheme now only accepts an object, not a string.  If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));");return}for(var r in e)(function(n){s[n]=function(t){if(typeof e[n]=="object"){var i=t;for(var o in e[n])i=s[e[n][o]](i);return i}return s[e[n]](t)};})(r);};function Ie(){var e={};return Object.keys(Q).forEach(function(r){e[r]={get:function(){return K([r])}};}),e}var Ge=function(r,n){var t=n.split("");return t=t.map(r),t.join("")};s.trap=j();s.zalgo=z();s.maps={};s.maps.america=A()(s);s.maps.zebra=P()(s);s.maps.rainbow=F()(s);s.maps.random=V()(s);for(H in s.maps)(function(e){s[e]=function(r){return Ge(s.maps[e],r)};})(H);var H;J(s,Ie());});var ee=d((or,Z)=>{var c=C();Z.exports=function(){var e=function(t,i){String.prototype.__defineGetter__(t,i);};e("strip",function(){return c.strip(this)}),e("stripColors",function(){return c.strip(this)}),e("trap",function(){return c.trap(this)}),e("zalgo",function(){return c.zalgo(this)}),e("zebra",function(){return c.zebra(this)}),e("rainbow",function(){return c.rainbow(this)}),e("random",function(){return c.random(this)}),e("america",function(){return c.america(this)});var r=Object.keys(c.styles);r.forEach(function(t){e(t,function(){return c.stylize(this,t)});});function n(t){var i=["__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","charAt","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","charCodeAt","indexOf","lastIndexOf","length","localeCompare","match","repeat","replace","search","slice","split","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimLeft","trimRight"];Object.keys(t).forEach(function(o){if(i.indexOf(o)!==-1)console.log("warn: ".red+("String.prototype"+o).magenta+" is probably something you don't want to override.  Ignoring style name");else if(typeof t[o]=="string")c[o]=c[t[o]],e(o,function(){return c[o](this)});else {var f=function(m){for(var g=m||this,a=0;a<t[o].length;a++)g=c[t[o][a]](g);return g};e(o,f),c[o]=function(m){return f(m)};}});}c.setTheme=function(t){if(typeof t=="string"){console.log("colors.setTheme now only accepts an object, not a string. If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));");return}else n(t);};};});var ne=d((ir,re)=>{var qe=C();re.exports=qe;ee()();});var u={};ye(u,{base:()=>Ye,error:()=>Le,info:()=>$e,success:()=>je,warn:()=>Be});Me(ne(),1);var Be=e=>{console.log(`[warn] ${e}`.yellow);},Le=e=>{console.log(`[error] ${e}`.red);},$e=e=>{console.log(`[info] ${e}`.cyan);},je=e=>{console.log(`[success] ${e}`.green);},Ye=e=>{console.log(e);};function te(e){let{user:{nickName:r,gender:n},content:t}=e;return u.base(`\u3010\u{1F4E8}\u5F39\u5E55\u3011 ${r}: ${t}`.green),e}function oe(e){return e}function ie(e){return e}function se(e){return e}function ae(e){let{user:{nickName:r,gender:n}}=e;return u.base(`\u3010\u2795\u5173\u6CE8\u3011${r} \u5173\u6CE8\u4E86\u4E3B\u64AD`.red),e}function ue(e){let{common:{describe:r},user:{nickName:n}}=e;return u.base(`\u3010\u{1F381}\u793C\u7269\u3011${r}`.yellow),e}function ce(e){let{user:{nickName:r,gender:n},memberCount:{low:t}}=e;return u.base(`\u3010\u{1F3E0}\u8FDB\u623F\u3011${r} \u8FDB\u5165\u4E86\u76F4\u64AD\u95F4\uFF0C\u5F53\u524D\u4EBA\u6570\uFF1A${String(t+1)}`),e}function le(e){let{user:{nickName:r,gender:n},count:t,total:i}=e;return u.base(`\u3010\u{1F44D}\u70B9\u8D5E\u3011${r} \u70B9\u8D5E\u4E86${String(t.low)}\u6B21\uFF0C\u76F4\u64AD\u95F4\u70B9\u8D5E\u603B\u6570\uFF1A${String(i.low+t.low)}`),e}function fe(e){return e}var De=async e=>{let{ttwid:r,liveRoomId:n}=await parseLiveUrl(e),t,i=await initWsConnect({ttwid:r,liveRoomId:n});i.binaryType="arraybuffer",i.onopen=()=>{t=setInterval(()=>{},1e4),u.info("connected");},i.onclose=()=>{clearInterval(t),u.warn("disconnected");},i.onerror=o=>u.error(String(o)),i.onmessage=o=>incoming(o,i,{handleChatMessage:te,handleCommonTextMessage:oe,handleGiftMessage:ue,handleLikeMessage:le,handleMatchAgainstScoreMessage:fe,handleMemberMessage:ce,handleRoomUserSeqMessage:se,handleSocialMessage:ae,handleUpdateFanTicketMessage:ie});},ge=De;var{prompt:Ue}=Pe,Fe=await Ue({type:"input",name:"liveID",message:"\u8F93\u5165\u6296\u97F3\u76F4\u64AD\u95F4ID?"});ge(Fe.liveID);process.on("SIGINT",()=>{u.error("Server stopped."),process.exit();});process.on("SIGTERM",()=>{u.error("Server stopped."),process.exit();});process.on("unhandledRejection",(e,r)=>{u.warn(`Unhandled Rejection at: ${r}; reason:, ${e}`);});process.on("uncaughtException",(e,r)=>{u.warn(`Caught exception: ${e}
Exception origin: ${r}`);});
